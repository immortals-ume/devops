apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-pg-hba
  namespace: db
  labels:
    app: postgres
  annotations:
    kubernetes.io/description: "PostgreSQL pg_hba.conf configuration. Mount as pg_hba.conf."
data:
  pg_hba.conf: |
    # TYPE  DATABASE        USER            ADDRESS                 METHOD
    local   all             all                                     trust
    host    all             all             0.0.0.0/0               scram-sha-256
    host    replication     replicator      0.0.0.0/0               scram-sha-256
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-sql
  namespace: db
  labels:
    app: postgres
  annotations:
    kubernetes.io/description: "PostgreSQL initialization SQL. Mount as 00_init.sql."
data:
  00_init.sql: |
    CREATE ROLE replicator WITH REPLICATION LOGIN ENCRYPTED PASSWORD 'test';
    select pg_create_physical_replication_slot('replication_slot'); 
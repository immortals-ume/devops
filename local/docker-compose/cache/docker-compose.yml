version: '3.9'

services:
  # Redis Standalone
  redis_standalone:
    image: redis:7.2-alpine
    container_name: redis_standalone
    ports:
      - "6379:6379"
    command: redis-server /usr/local/etc/redis/redis.conf
    volumes:
      - redis_standalone_data:/data
      - ./redis_standalone.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Cluster - Node 1
  redis_cluster_1:
    image: redis:7.2-alpine
    container_name: redis_cluster_1
    ports:
      - "7000:7000"
      - "17000:17000"
    command: redis-server /usr/local/etc/redis/redis.conf --port 7000 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    volumes:
      - redis_cluster_1_data:/data
      - ./redis_cluster.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7000", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Cluster - Node 2
  redis_cluster_2:
    image: redis:7.2-alpine
    container_name: redis_cluster_2
    ports:
      - "7001:7001"
      - "17001:17001"
    command: redis-server /usr/local/etc/redis/redis.conf --port 7001 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    volumes:
      - redis_cluster_2_data:/data
      - ./redis_cluster.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7001", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Cluster - Node 3
  redis_cluster_3:
    image: redis:7.2-alpine
    container_name: redis_cluster_3
    ports:
      - "7002:7002"
      - "17002:17002"
    command: redis-server /usr/local/etc/redis/redis.conf --port 7002 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    volumes:
      - redis_cluster_3_data:/data
      - ./redis_cluster.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7002", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Cluster - Node 4
  redis_cluster_4:
    image: redis:7.2-alpine
    container_name: redis_cluster_4
    ports:
      - "7003:7003"
      - "17003:17003"
    command: redis-server /usr/local/etc/redis/redis.conf --port 7003 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    volumes:
      - redis_cluster_4_data:/data
      - ./redis_cluster.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7003", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Cluster - Node 5
  redis_cluster_5:
    image: redis:7.2-alpine
    container_name: redis_cluster_5
    ports:
      - "7004:7004"
      - "17004:17004"
    command: redis-server /usr/local/etc/redis/redis.conf --port 7004 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    volumes:
      - redis_cluster_5_data:/data
      - ./redis_cluster.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7004", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Cluster - Node 6
  redis_cluster_6:
    image: redis:7.2-alpine
    container_name: redis_cluster_6
    ports:
      - "7005:7005"
      - "17005:17005"
    command: redis-server /usr/local/etc/redis/redis.conf --port 7005 --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    volumes:
      - redis_cluster_6_data:/data
      - ./redis_cluster.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "7005", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Sentinel - Master
  redis_sentinel_master:
    image: redis:7.2-alpine
    container_name: redis_sentinel_master
    ports:
      - "6380:6379"
    command: redis-server /usr/local/etc/redis/redis.conf --port 6379
    volumes:
      - redis_sentinel_master_data:/data
      - ./redis_sentinel_master.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Sentinel - Replica 1
  redis_sentinel_replica1:
    image: redis:7.2-alpine
    container_name: redis_sentinel_replica1
    ports:
      - "6381:6379"
    command: redis-server /usr/local/etc/redis/redis.conf --port 6379 --replicaof redis_sentinel_master 6379
    depends_on:
      redis_sentinel_master:
        condition: service_healthy
    volumes:
      - redis_sentinel_replica1_data:/data
      - ./redis_sentinel_replica.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Sentinel - Replica 2
  redis_sentinel_replica2:
    image: redis:7.2-alpine
    container_name: redis_sentinel_replica2
    ports:
      - "6382:6379"
    command: redis-server /usr/local/etc/redis/redis.conf --port 6379 --replicaof redis_sentinel_master 6379
    depends_on:
      redis_sentinel_master:
        condition: service_healthy
    volumes:
      - redis_sentinel_replica2_data:/data
      - ./redis_sentinel_replica.conf:/usr/local/etc/redis/redis.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Sentinel 1
  sentinel1:
    image: redis:7.2-alpine
    container_name: sentinel1
    ports:
      - "26379:26379"
    command: redis-sentinel /usr/local/etc/redis/sentinel.conf
    depends_on:
      redis_sentinel_master:
        condition: service_healthy
    volumes:
      - sentinel1_data:/data
      - ./sentinel.conf:/usr/local/etc/redis/sentinel.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "26379", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Sentinel 2
  sentinel2:
    image: redis:7.2-alpine
    container_name: sentinel2
    ports:
      - "26380:26379"
    command: redis-sentinel /usr/local/etc/redis/sentinel.conf
    depends_on:
      redis_sentinel_master:
        condition: service_healthy
    volumes:
      - sentinel2_data:/data
      - ./sentinel.conf:/usr/local/etc/redis/sentinel.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "26379", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Sentinel 3
  sentinel3:
    image: redis:7.2-alpine
    container_name: sentinel3
    ports:
      - "26381:26379"
    command: redis-sentinel /usr/local/etc/redis/sentinel.conf
    depends_on:
      redis_sentinel_master:
        condition: service_healthy
    volumes:
      - sentinel3_data:/data
      - ./sentinel.conf:/usr/local/etc/redis/sentinel.conf:ro
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "26379", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  # Redis Commander - Web UI
  redis_commander:
    image: rediscommander/redis-commander:latest
    container_name: redis_commander
    ports:
      - "8081:8081"
    environment:
      REDIS_HOSTS: |
        standalone:redis_standalone:6379,
        cluster:redis_cluster_1:7000,
        sentinel:redis_sentinel_master:6380
    depends_on:
      - redis_standalone
      - redis_cluster_1
      - redis_sentinel_master
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8081"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
    restart: unless-stopped
    networks:
      - redis
    security_opt:
      - no-new-privileges:true
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.25'
          memory: 128M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  redis_standalone_data:
    driver: local
  redis_cluster_1_data:
    driver: local
  redis_cluster_2_data:
    driver: local
  redis_cluster_3_data:
    driver: local
  redis_cluster_4_data:
    driver: local
  redis_cluster_5_data:
    driver: local
  redis_cluster_6_data:
    driver: local
  redis_sentinel_master_data:
    driver: local
  redis_sentinel_replica1_data:
    driver: local
  redis_sentinel_replica2_data:
    driver: local
  sentinel1_data:
    driver: local
  sentinel2_data:
    driver: local
  sentinel3_data:
    driver: local

networks:
  redis:
    driver: bridge
